# ============================================================
# Intelligent Customer Service - Configuration
# ============================================================

# ============ Application Settings ============
APP_NAME=Intelligent Customer Service
APP_VERSION=1.0.0
DEBUG=true

# ============ Server Settings ============
HOST=0.0.0.0
PORT=8000

# ============ CORS Settings ============
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000,http://localhost:5173

# ============ LLM Configuration ============
LLM_PROVIDER=ollama
# 可选模型: llama3:latest, qwen3:latest, deepseek-r1:7b
LLM_MODEL=qwen3:latest
LLM_BASE_URL=http://localhost:11434
LLM_API_KEY=
LLM_TEMPERATURE=0.7
LLM_MAX_TOKENS=2048

# Claude API (optional)
# CLAUDE_API_KEY=your-claude-api-key
# CLAUDE_MODEL=claude-sonnet-4-20250514

# ============ Embedding Configuration ============
EMBEDDING_MODEL=nomic-embed-text
EMBEDDING_BASE_URL=http://localhost:11434
EMBEDDING_BATCH_SIZE=50
EMBEDDING_MAX_CONCURRENT=20

# ============ Milvus Vector Store ============
MILVUS_HOST=localhost
MILVUS_PORT=19530
MILVUS_COLLECTION=customer_service_kb
MILVUS_DATABASE=default

# ============ Elasticsearch Configuration ============
ELASTICSEARCH_ENABLED=true
ELASTICSEARCH_HOSTS=http://localhost:9200
ELASTICSEARCH_USERNAME=
ELASTICSEARCH_PASSWORD=
ELASTICSEARCH_INDEX_PREFIX=knowledge_base
ELASTICSEARCH_CHUNK_INDEX=knowledge_base_chunks
ELASTICSEARCH_USE_SSL=false
ELASTICSEARCH_VERIFY_CERTS=true
ELASTICSEARCH_CA_CERTS=
ELASTICSEARCH_TIMEOUT=30
ELASTICSEARCH_MAX_RETRIES=3

# ============ Hybrid Storage (ES + Milvus) ============
HYBRID_STORAGE_ENABLED=true
HYBRID_MILVUS_WEIGHT=0.7
HYBRID_ES_WEIGHT=0.3
HYBRID_SEARCH_TOP_K=20

# ============ RAG Configuration ============
RAG_CHUNK_SIZE=500
RAG_CHUNK_OVERLAP=50
RAG_TOP_K=5

# RAG Query Transformation
# 注意: HyDE 和 Query Expansion 会显著增加响应时间（每次额外 30-60 秒）
# 如果 LLM 响应较慢，建议禁用以提升用户体验
RAG_ENABLE_HYDE=false
RAG_ENABLE_QUERY_EXPANSION=false
RAG_QUERY_EXPANSION_NUM=3

# RAG Hybrid Retrieval
RAG_ENABLE_HYBRID=true
RAG_VECTOR_WEIGHT=0.7
RAG_BM25_WEIGHT=0.3
RAG_RETRIEVAL_TOP_K=10

# RAG Reranking (Jina)
RAG_ENABLE_RERANK=true
RAG_RERANK_MODEL=jinaai/jina-reranker-v2-base-multilingual
RAG_RERANK_TOP_N=5
RAG_RERANK_SCORE_THRESHOLD=0.3

# RAG Post-processing
RAG_ENABLE_DEDUP=true
RAG_DEDUP_THRESHOLD=0.95
RAG_FINAL_TOP_K=5

# RAG Document Processing
RAG_USE_SEMANTIC_CHUNKING=false

# RAG Evaluation
RAG_ENABLE_EVALUATION=true
RAG_EVALUATION_LOG_LEVEL=INFO

# ============ Database ============
DATABASE_URL=sqlite+aiosqlite:///./data/customer_service.db

# ============ Redis Cache ============
REDIS_URL=redis://localhost:6379/0
REDIS_CACHE_ENABLED=true
REDIS_CACHE_TTL=3600
REDIS_EMBEDDING_CACHE_TTL=86400
REDIS_SEARCH_CACHE_TTL=300

# ============ Knowledge Base ============
KNOWLEDGE_BASE_PATH=./data/knowledge_base
AUTO_INDEX_KNOWLEDGE_BASE=true

# ============ Logging Configuration ============
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO
# Log directory (relative or absolute path)
LOG_DIR=./logs
# Output logs to console
LOG_TO_CONSOLE=true
# Output logs to file
LOG_TO_FILE=true
# Use JSON format for file logs (useful for log aggregation)
LOG_JSON_FORMAT=false
# Max log file size before rotation (in bytes, default 10MB)
LOG_MAX_BYTES=10485760
# Number of backup log files to keep
LOG_BACKUP_COUNT=30
# Separate log file for RAG pipeline (rag-YYYY-MM-DD.log)
LOG_RAG_SEPARATE=true
# Days to keep old log files before cleanup
LOG_CLEANUP_DAYS=30

# ============ Langfuse Observability ============
LANGFUSE_ENABLED=true
LANGFUSE_SECRET_KEY=sk-lf-cd7bcb7d-27ad-4049-b4f7-4f2ca441d579
LANGFUSE_PUBLIC_KEY=pk-lf-dd167d24-a007-4afb-a3af-8c37a922870f
LANGFUSE_HOST=https://cloud.langfuse.com

# ============ Agent Configuration ============
AGENT_ENABLED=true
AGENT_MAX_ITERATIONS=5
AGENT_MEMORY_MAX_MESSAGES=20
AGENT_MEMORY_SUMMARY_THRESHOLD=10
AGENT_ENABLE_PLANNING=false
AGENT_ENABLE_PARALLEL_TOOLS=true
AGENT_TOOL_TIMEOUT=30
AGENT_MAX_TOOL_CONCURRENCY=5

# ============ MCP Tools ============
MCP_WEB_SEARCH_ENABLED=true
MCP_CODE_EXECUTION_ENABLED=false
MCP_FILE_SYSTEM_ENABLED=true
MCP_CODE_EXECUTION_TIMEOUT=30
